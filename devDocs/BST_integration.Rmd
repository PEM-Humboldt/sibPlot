---
title: "Integration of the core data of BST, using Roy's scripts"
author: "Marius Bottin"
date: '`r format(Sys.time(), "%d %B, %Y")`'
output: 
   pdf_document:
     toc: true
     toc_depth: 5
     number_sections: true
     latex_engine: xelatex
always_allow_html: true
fontsize: 11pt
geometry: "left=3cm,right=3cm,top=3cm,bottom=3cm"
linkcolor: gray
urlcolor: blue
citecolor: cyan
header-includes:
  - \usepackage{colortbl}
  - \usepackage{xcolor}       
  - \usepackage{lscape}
  - \usepackage{fvextra}
  - \DefineVerbatimEnvironment{Highlighting}{Verbatim}{breaklines,commandchars=\\\{\}}
--- 


***************

```{r, setup, message=F, warning=F, include=F}
require(knitr)&require(RPostgreSQL)&require(formatR)&require(kableExtra)
def.chunk.hook  <- knitr::knit_hooks$get("chunk")
knitr::knit_hooks$set(chunk = function(x, options) {
  x <- def.chunk.hook(x, options)
  ifelse(options$size != "normalsize", paste0("\n \\", options$size,"\n\n", x, "\n\n \\normalsize"), x)
})
opts_chunk$set(cache=F,fig.path="../../Fig/BST_integration",tidy='styler',cache.rebuild = F,formatSQL = TRUE, size='scriptsize',
               echo=T, message=T, warning=T)
options(knitr.kable.NA = '---')
```


The idea here is to try and integrate the BST (Bosque Seco Tropical) data in the database, using Roy's scripts, without transforming them in re-usable functions just yet, in order to have a functional database, and to determine what will be the potential problems to address.


# Reading the data with Roy's scripts

```{r, warning=F}
folderData <- "../../CodeRoy/BasesHumboldt-MV/core/"
folderMetadata <- paste0(folderData,"metadata/")
folderCensus0 <- paste0(folderData,"census0/")
folderCensus1 <- paste0(folderData,"census1/")
folderDates <- paste0(folderData,"dates/")
folderMembers <- paste0(folderData,"members/")
folderTaxonomy <- paste0(folderData,"taxonomy/")
source("../scripts/codesR/1.imput.metadata.R")
source("../scripts/codesR/2.imput.taxonomy.R")
source("../scripts/codesR/3.imput.censuses.census0.R")
source("../scripts/codesR/4.imput.dates.R")
source("../scripts/codesR/5.imput.members.R")
```

Roy's scripts consist in storing all the data in a *"dataForests"* variable.
```{r}
names(dataForests)
```



# Adapting the data to the database

## Separating event and inputs

```{r}
namesDates <- names(dataForests$dates)
tabEvents<-data.frame(plot=rep(namesDates,sapply(dataForests$dates,nrow)),Reduce(rbind,dataForests$dates))
```


